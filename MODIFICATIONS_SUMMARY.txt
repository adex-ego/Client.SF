â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  RÃ‰SUMÃ‰ DES MODIFICATIONS - APPELS AUDIO, VIDÃ‰O ET CHAT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FICHIER: src/main/java/com/securephone/client/network/ConnectionManager.java

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MODIFICATION 1: Ajout de l'interface CallListener (aprÃ¨s NotificationListener)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

+   public interface CallListener {
+       void onCallIncoming(String callerId, String callerName, String callType);
+       void onCallAccepted(String callerId, String callType);
+       void onCallRejected(String callerId, String reason);
+       void onCallEnded(String callerId);
+       void onCallError(String message);
+   }

DÃ‰TAIL:
  â€¢ onCallIncoming(): ReÃ§u quand quelqu'un nous appelle
  â€¢ onCallAccepted(): ReÃ§u quand la personne accepte notre appel
  â€¢ onCallRejected(): ReÃ§u quand la personne rejette notre appel
  â€¢ onCallEnded(): ReÃ§u quand l'appel se termine cÃ´tÃ© distant
  â€¢ onCallError(): Erreur lors d'une opÃ©ration d'appel

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MODIFICATION 2: Ajout de variables pour l'Ã©tat de l'appel
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

+   private CallListener callListener;
+
+   private String currentCallId = null;
+   private String currentCallType = null;
+   private String currentCallRemoteUser = null;

DÃ‰TAIL:
  â€¢ currentCallId: UUID unique gÃ©nÃ©rÃ© pour chaque appel
  â€¢ currentCallType: "audio" ou "video"
  â€¢ currentCallRemoteUser: nom d'utilisateur de l'autre participant

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MODIFICATION 3: Setter pour CallListener
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

+   public void setCallListener(CallListener listener) {
+       this.callListener = listener;
+   }

UTILISATION:
  connectionManager.setCallListener(new ConnectionManager.CallListener() {
      @Override
      public void onCallIncoming(String callerId, String callerName, String callType) {
          // Afficher dialogue d'appel entrant
      }
      // ... autres mÃ©thodes
  });

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MODIFICATION 4: MÃ©thode initiateCall()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

+   public void initiateCall(String remoteName, String callType) {
+       if (!session.isLoggedIn()) {
+           if (callListener != null) {
+               callListener.onCallError("Non connectÃ©");
+           }
+           return;
+       }
+       try {
+           this.currentCallId = java.util.UUID.randomUUID().toString();
+           this.currentCallType = callType;
+           this.currentCallRemoteUser = remoteName;
+
+           ChatPacket packet = new ChatPacket(MessageType.CALL_INITIATE);
+           JSONObject data = new JSONObject();
+           data.put("call_id", currentCallId);
+           data.put("call_type", callType); // "audio" ou "video"
+           data.put("caller_id", session.getUserId());
+           data.put("caller_name", session.getUsername());
+           data.put("receiver_name", remoteName);
+           data.put("timestamp", System.currentTimeMillis());
+           packet.setData(data);
+           chatClient.send(packet.toJson());
+           Logger.info("ğŸ“ Appel initialisÃ©: " + callType + " avec " + remoteName);
+       } catch (Exception e) {
+           Logger.error("Erreur initialisation appel: " + e.getMessage());
+           if (callListener != null) {
+               callListener.onCallError(e.getMessage());
+           }
+       }
+   }

USAGE:
  connectionManager.initiateCall("bob", "audio");   // Appel vocal
  connectionManager.initiateCall("alice", "video");  // Appel vidÃ©o

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MODIFICATION 5: MÃ©thode acceptCall()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

+   public void acceptCall(String callType) {
+       if (!session.isLoggedIn() || currentCallId == null) {
+           if (callListener != null) {
+               callListener.onCallError("Appel non disponible");
+           }
+           return;
+       }
+       try {
+           // DÃ©marrer capture audio/vidÃ©o
+           if ("audio".equals(callType)) {
+               startAudio();
+           } else if ("video".equals(callType)) {
+               startVideo();
+               startAudio(); // Audio aussi pour la vidÃ©o
+           }
+
+           // Envoyer acceptation au serveur
+           ChatPacket packet = new ChatPacket(MessageType.CALL_ACCEPT);
+           JSONObject data = new JSONObject();
+           data.put("call_id", currentCallId);
+           data.put("call_type", callType);
+           data.put("accepter_id", session.getUserId());
+           data.put("accepter_name", session.getUsername());
+           data.put("timestamp", System.currentTimeMillis());
+           packet.setData(data);
+           chatClient.send(packet.toJson());
+           Logger.info("âœ… Appel acceptÃ©: " + callType);
+       } catch (Exception e) {
+           Logger.error("Erreur acceptation appel: " + e.getMessage());
+           if (callListener != null) {
+               callListener.onCallError(e.getMessage());
+           }
+       }
+   }

Actions:
  1. DÃ©marre AudioClient si appel vocal
  2. DÃ©marre VideoClient + AudioClient si appel vidÃ©o
  3. Envoie CALL_ACCEPT au serveur
  4. Logs l'action

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MODIFICATION 6: MÃ©thode rejectCall()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

+   public void rejectCall(String reason) {
+       if (!session.isLoggedIn() || currentCallId == null) {
+           return;
+       }
+       try {
+           ChatPacket packet = new ChatPacket(MessageType.CALL_REJECT);
+           JSONObject data = new JSONObject();
+           data.put("call_id", currentCallId);
+           data.put("rejection_reason", reason != null ? reason : "Rejet");
+           data.put("rejecter_id", session.getUserId());
+           data.put("timestamp", System.currentTimeMillis());
+           packet.setData(data);
+           chatClient.send(packet.toJson());
+           currentCallId = null;
+           currentCallType = null;
+           currentCallRemoteUser = null;
+           Logger.info("âŒ Appel rejetÃ©");
+       } catch (Exception e) {
+           Logger.error("Erreur rejet appel: " + e.getMessage());
+       }
+   }

Actions:
  1. Envoie CALL_REJECT avec motif
  2. Nettoie l'Ã©tat de l'appel
  3. Logs l'action

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MODIFICATION 7: MÃ©thode endCall()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

+   public void endCall() {
+       if (!session.isLoggedIn() || currentCallId == null) {
+           return;
+       }
+       try {
+           // ArrÃªter capture/rÃ©ception
+           stopAudio();
+           stopVideo();
+
+           // Notifier le serveur
+           ChatPacket packet = new ChatPacket(MessageType.CALL_END);
+           JSONObject data = new JSONObject();
+           data.put("call_id", currentCallId);
+           data.put("ender_id", session.getUserId());
+           data.put("timestamp", System.currentTimeMillis());
+           packet.setData(data);
+           chatClient.send(packet.toJson());
+
+           currentCallId = null;
+           currentCallType = null;
+           currentCallRemoteUser = null;
+           Logger.info("ğŸ”š Appel terminÃ©");
+       } catch (Exception e) {
+           Logger.error("Erreur fin appel: " + e.getMessage());
+       }
+   }

Actions:
  1. ArrÃªte AudioClient et VideoClient
  2. Envoie CALL_END au serveur
  3. Nettoie l'Ã©tat de l'appel
  4. Logs l'action

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MODIFICATION 8: MÃ©thodes utilitaires
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

+   public String getCurrentCallType() {
+       return currentCallType;
+   }
+
+   public String getCurrentCallRemoteUser() {
+       return currentCallRemoteUser;
+   }
+
+   public boolean hasActiveCall() {
+       return currentCallId != null;
+   }

UtilitÃ©:
  â€¢ getCurrentCallType(): "audio", "video", ou null
  â€¢ getCurrentCallRemoteUser(): nom d'utilisateur du participant
  â€¢ hasActiveCall(): vÃ©rifier s'il y a un appel actif

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MODIFICATION 9: Traitement de CALL_INITIATE dans handleMessage()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

AJOUTÃ‰ avant MessageType.ERROR:

+           if (type == MessageType.CALL_INITIATE) {
+               String callId = data.optString("call_id");
+               String callType = data.optString("call_type");
+               int callerId = data.optInt("caller_id");
+               String callerName = data.optString("caller_name");
+               
+               currentCallId = callId;
+               currentCallType = callType;
+               currentCallRemoteUser = callerName;
+               
+               if (callListener != null) {
+                   callListener.onCallIncoming(String.valueOf(callerId), callerName, callType);
+               }
+               Logger.info("ğŸ“ Appel entrant: " + callType + " de " + callerName);
+               return;
+           }

RÃ©action:
  â€¢ Stocke infos appel entrant
  â€¢ Appelle callback onCallIncoming()
  â€¢ Attend l'acceptation/rejet cÃ´tÃ© UI

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MODIFICATION 10: Traitement de CALL_ACCEPT dans handleMessage()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

AJOUTÃ‰ avant MessageType.ERROR:

+           if (type == MessageType.CALL_ACCEPT) {
+               String callType = data.optString("call_type");
+               if (callListener != null) {
+                   callListener.onCallAccepted(currentCallRemoteUser, callType);
+               }
+               Logger.info("âœ… Appel acceptÃ© par " + currentCallRemoteUser);
+               return;
+           }

RÃ©action:
  â€¢ Notifie callback onCallAccepted()
  â€¢ Audio/VidÃ©o fonctionnent automatiquement (dÃ©jÃ  lancÃ©s)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MODIFICATION 11: Traitement de CALL_REJECT dans handleMessage()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

AJOUTÃ‰ avant MessageType.ERROR:

+           if (type == MessageType.CALL_REJECT) {
+               String reason = data.optString("rejection_reason", "RejetÃ©");
+               if (callListener != null) {
+                   callListener.onCallRejected(currentCallRemoteUser, reason);
+               }
+               currentCallId = null;
+               currentCallType = null;
+               currentCallRemoteUser = null;
+               Logger.info("âŒ Appel rejetÃ©: " + reason);
+               return;
+           }

RÃ©action:
  â€¢ Notifie callback onCallRejected()
  â€¢ Nettoie l'Ã©tat
  â€¢ Logs

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MODIFICATION 12: Traitement de CALL_END dans handleMessage()
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

AJOUTÃ‰ avant MessageType.ERROR:

+           if (type == MessageType.CALL_END) {
+               stopAudio();
+               stopVideo();
+               if (callListener != null) {
+                   callListener.onCallEnded(currentCallRemoteUser);
+               }
+               currentCallId = null;
+               currentCallType = null;
+               currentCallRemoteUser = null;
+               Logger.info("ğŸ”š Appel terminÃ© par l'autre cÃ´tÃ©");
+               return;
+           }

RÃ©action:
  â€¢ ArrÃªte audio/vidÃ©o
  â€¢ Notifie callback onCallEnded()
  â€¢ Nettoie l'Ã©tat

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

RÃ‰SUMÃ‰ DES CHANGEMENTS:

âœ“ 1 interface CallListener
âœ“ 3 variables member pour Ã©tat appel
âœ“ 1 setter setCallListener()
âœ“ 5 public methods: initiateCall, acceptCall, rejectCall, endCall + accessors
âœ“ 4 message handlers: CALL_INITIATE, CALL_ACCEPT, CALL_REJECT, CALL_END

LIGNES MODIFIÃ‰ES: ~250 lignes ajoutÃ©es dans ConnectionManager.java

NO OTHER FILES WERE MODIFIED.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VÃ‰RIFICATION DE LA COMPILATION

$ mvn clean compile
[INFO] Building SecurePhone Client 1.0-SNAPSHOT
[INFO] Compiling 51 source files with javac [debug release 11]
[INFO] BUILD SUCCESS

âœ“ Compilation rÃ©ussie sans erreurs
âœ“ Tous les 51 fichiers compilent correctement

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STRUCTURE FINALE - TROIS MODES DE COMMUNICATION

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SECUREPHONE COMMUNICATION                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1ï¸âƒ£ CHAT Ã‰LECTRONIQUE (TCP Socket)                                         â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚     â€¢ WebSocketClient avec BufferedReader/Writer                          â”‚
â”‚     â€¢ Port 8081 (dÃ©faut)                                                  â”‚
â”‚     â€¢ Messages JSON via ChatPacket                                        â”‚
â”‚     â€¢ Synchrone, persistent, avec listeners                              â”‚
â”‚     â””â”€ DÃ‰JÃ€ FONCTIONNEL (sendChatMessage)                                â”‚
â”‚                                                                             â”‚
â”‚  2ï¸âƒ£ APPEL VOCAL (UDP DatagramSocket)                                       â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚     â€¢ AudioClient avec capture microphone (AudioCapture)                 â”‚
â”‚     â€¢ Port 50000 (dÃ©faut)                                                â”‚
â”‚     â€¢ PCM 48 kHz 16-bit mono                                             â”‚
â”‚     â€¢ AudioPacket: userId + sequenceNumber + timestamp + audio           â”‚
â”‚     â€¢ Asynchrone, pair-Ã -pair via serveur relais                         â”‚
â”‚     â””â”€ FONCTIONNEL VIA: startAudio() + acceptCall("audio")               â”‚
â”‚                                                                             â”‚
â”‚  3ï¸âƒ£ APPEL VIDÃ‰O (UDP DatagramSocket)                                       â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚     â€¢ VideoClient avec capture frames (VideoCapture)                     â”‚
â”‚     â€¢ Port 50020 (dÃ©faut)                                                â”‚
â”‚     â€¢ JPEG compression (Ã  amÃ©liorer)                                     â”‚
â”‚     â€¢ VideoPacket: userId + frameNumber + width/height + video           â”‚
â”‚     â€¢ Asynchrone, pair-Ã -pair via serveur relais                         â”‚
â”‚     â””â”€ FONCTIONNEL VIA: startVideo() + acceptCall("video")               â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CONTRÃ”LE D'APPEL (WebSocket - CALL_* messages)                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚  â€¢ initiateCall(remoteName, "audio"|"video")  ..................... Appeler â”‚
â”‚  â€¢ acceptCall("audio"|"video") ............................ Accepter appel â”‚
â”‚  â€¢ rejectCall(reason) ............................ Rejeter appel entrant â”‚
â”‚  â€¢ endCall() .................................. Terminer appel actif â”‚
â”‚  â€¢ hasActiveCall() ............................. VÃ©rifier appel actif â”‚
â”‚  â€¢ setCallListener(listener) .................. DÃ©finir callbacks â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EXEMPLE D'UTILISATION COMPLÃˆTE DANS L'UI

// Dans SecurePhoneApp ou AppPage

ConnectionManager cm = connectionManager;

// Enregistrer les callbacks
cm.setCallListener(new ConnectionManager.CallListener() {
    @Override
    public void onCallIncoming(String callerId, String callerName, String callType) {
        showIncomingCallDialog(callerName, callType);
    }
    
    @Override
    public void onCallAccepted(String callerId, String callType) {
        showActiveCall(callerId, callType);
    }
    
    @Override
    public void onCallRejected(String callerId, String reason) {
        showMessage("Appel rejetÃ©: " + reason);
    }
    
    @Override
    public void onCallEnded(String callerId) {
        hideActiveCall();
    }
    
    @Override
    public void onCallError(String message) {
        showError("Erreur appel: " + message);
    }
});

// --- Lancer un appel ---

// Clic sur bouton "Appeler Alice (Audio)"
cm.initiateCall("alice", "audio");

// Clic sur bouton "Appeler Bob (VidÃ©o)"
cm.initiateCall("bob", "video");

// --- RÃ©pondre Ã  un appel ---

// Quand onCallIncoming() s'active (Alice appelle)
// Clic sur "Accepter"
cm.acceptCall("audio");  // ou "video"

// Clic sur "Rejeter"
cm.rejectCall("Je suis occupÃ©");

// --- Terminer un appel ---

// Clic sur bouton "Raccrocher"
cm.endCall();

// --- Envoyer un message ---
cm.sendChatMessage("Salut Alice!", "alice");

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
